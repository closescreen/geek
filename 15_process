#!/usr/bin/env bash
#> Making table "sessions" (tn3).

#>> in:
#>> ожидаются поля: dom, uid, sestart
# входной формат дается в этом параметре:
lb=${1:?labels!}

lae -lb="$lb" '
my ( %sessions, %views );
_{
  return if not Isview;

  $sessions{ &Dom }{ join("*", &Uid, &Sestart) }||=1;
  $views{ &Dom }++;
};

for my $dom ( keys %views ){
    p0 $dom, scalar(keys %{$sessions{ $dom }}), $views{ $dom };
}

'

#>> OUT: dom, sessions_count, views_count
#>> 
#>> | field          | description |
#>> | -------------- | ----------- |
#>> | dom            |
#>> | sessions_count |
#>> | views_count    |