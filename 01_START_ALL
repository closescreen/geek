#!/usr/bin/env bash
#> Запуск всех скриптов.
(
set -u
set +x
set -o pipefail
cd `dirname $0`

[[ -s 01_STOP_ALL.stop ]] && echo "01_STOP_ALL.stop found! Remove it and try again.">&2 && exit 1

export PATH=$PATH:/home/d.belyaev/grep/bike

jobs="google"
typenums="0 1 3"
for job in $jobs;do
    for typenum in $typenums; do
	fork -pf="../pids/10.$job.t${typenum}.pids" -n=1 -kill "nice -n15 ./10_HOURS $job $typenum"
	if [[ "$typenum" -eq 3 ]]; then
	    fork -pf="../pids/11.$job.t${typenum}.pids" -single "nice -n15 ./11_REMOVE $job $typenum" # (for tn3 only)
	fi
	fork -pf="../pids/12.$job.t${typenum}.pids" -single "nice -n15 ./12_MERGE $job $typenum"
	fork -pf="../pids/13.$job.t${typenum}.pids" -single "nice -n15 ./13_REMOVE $job $typenum" # deleting empty files

	fork -pf="../pids/14.$job.pids" -n=1 -kill "nice -n15 ./14_BIDS $job" # несрочно
	fork -pf="../pids/15.$job.pids" -n=1 -kill "nice -n15 ./15_SESSIONS $job" # несрочно
	fork -pf="../pids/16.$job.pids" -n=1 -kill "nice -n15 ./16_PZBT $job" # несрочно

	fork -pf="../pids/17.$job.pids" -n=1 -kill "nice ./17_URLS $job" # urls 

	fork -pf="../pids/18.$job.pids" -n=1 -kill "nice -n15 ./18_UIDSZ $job" # uidsz # несрочно
	fork -pf="../pids/19.$job.pids" -n=1 -kill "nice -n15 ./19_URLS30DAYS $job" # urls30days
	fork -pf="../pids/20.$job.pids" -n=1 -kill "nice -n15 ./20_DOM30DAYS $job" # dom30days
	fork -pf="../pids/21.$job.pids" -n=1 -kill "nice -n15 ./21_DOMGR $job" # dom_gr
	fork -pf="../pids/22.$job.pids" -n=1 -kill "nice -n15 ./22_URLSGROUPS $job" # urls_groups
	fork -pf="../pids/29.$job.pids" -n=1 -kill "nice -n15 ./29_JOIN $job" # table_29 (by sz, ad) # несрочно
	fork -pf="../pids/30.$job.pids" -n=1 -kill "nice -n15 ./30_SUM $job" # table_30 (by sz) # несрочно

	#fork -pf="../pids/32.$job.pids" -n=1 -kill "nice -n15 ./32_ $job" # gender # несрочно
    done
done

)#>>"$0.log" 2>&1
