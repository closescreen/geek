#!/usr/bin/env bash
#> Удаление старых данных.


(
set -u
set +x
set -o pipefail
cd `dirname $0`


#>> Удаление часовых данных, (в основном, для tn3) (для экономии места).


#-----часовые данные ----
jobs="google ssp_sites net_sites"
typenums="0 1 3"

for job in $jobs; do
 for tn in $typenums; do
  ff=`find ../RESULT/10/  -type f -wholename "*/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/$job/$tn/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]T[0-9][0-9].gz" |
  only -near=total.gz |
  only -older=4days`
  [[ -n "$ff" ]] && rm $ff
 done
done

#----------- старые /RESULT/10 ----
# Удаление ЛЮБЫХ данных /RESULT/10/$day/$job/$typenum, старее указанного
oldff=`find ../RESULT/10/ -name "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]" -type d |
 only --older=60days`
[[ -n "$oldff" ]] && rm -rf $oldff


#----------- старые ../RESULT/traits_copy ----
# Удаление traits_copy
oldff=`find ../RESULT/traits_copy/ -name "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]" -type d | 
 only -having='s|traits_copy/(\d\d\d\d-\d\d-\d\d)|10/$1/google/3/sz_vars_30days.gz|' | 
 only -older=10days`
[[ -n "$oldff" ]] && rm -rf $oldff


#----------- пустые *.gz == 20байт ----------
emptyff=`find ../RESULT/ -type f -name "*.gz" | only -sizele=20`
[[ -n "$emptyff" ]] && echo -e "Found empty files: $emptyff \n -will removed." && rm $emptyff

# ---- google/3/urls30days.gz --------
old_urls30days_ff=`find ../RESULT -wholename "*/3/urls30days.gz" |
 only --older=8days |
 only -near=sz_vars_30days.gz`
[[ -n "$old_urls30days_ff" ]] && rm $old_urls30days_ff

)>>"$0.log" 2>&1
