#!/usr/bin/env bash
#> Удаление старых данных.


(
set -u
set +x
set -o pipefail
cd `dirname $0`


#>> Удаление часовых данных, (в основном, для tn3) (для экономии места).


#-----часовые данные google 3 ----
jobs="google ssp_sites"
typenum="3"

for job in $jobs; do
 ff=`find ../RESULT/10/[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]/$job/$typenum -type f -name "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]T[0-9][0-9].gz" |
 only -near=total.gz | only -older=6days`
 [[ -n "$ff" ]] && rm $ff
done

#----------- старые /RESULT/10 ----
# Удаление любых данных /RESULT/10/$day/$job/$typenum, старее указанного
oldff=`find ../RESULT/10/ -name "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]" -type d | only --older=40days`
[[ -n "$oldff" ]] && rm -rf $oldff


#----------- старые ../RESULT/traits_copy ----
# Удаление traits_copy
oldff=`find ../RESULT/traits_copy/ -name "[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]" -type d | only --older=10days`
[[ -n "$oldff" ]] && rm -rf $oldff


#----------- пустые *.gz == 20байт ----------
emptyff=`find ../RESULT/ -type f -name "*.gz" | only -sizele=20`
[[ -n "$emptyff" ]] && echo -e "Found empty files: $emptyff \n -will removed." && rm $emptyff

# ---- google/3/urls30days.gz --------
old_urls30days_ff=`find ../RESULT -wholename "*/3/urls30days.gz" | only --older=8days | only -near=sz_vars_30days.gz`
[[ -n "$old_urls30days_ff" ]] && rm $old_urls30days_ff

)>>"$0.log" 2>&1
